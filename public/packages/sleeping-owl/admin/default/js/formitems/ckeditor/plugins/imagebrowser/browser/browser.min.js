var CkEditorImageBrowser={folders:[],images:{},ckFunctionNum:null,$folderSwitcher:null,$imagesContainer:null,init:function(){CkEditorImageBrowser.$folderSwitcher=$("#js-folder-switcher"),CkEditorImageBrowser.$imagesContainer=$("#js-images-container");var e=CkEditorImageBrowser.getQueryStringParam("baseHref");if(e){var r=document.head||document.getElementsByTagName("head")[0];r.getElementsByTagName("link")[0].href=location.href.replace(/\/[^\/]*$/,"/browser.css"),r.getElementsByTagName("base")[0].href=e}CkEditorImageBrowser.ckFunctionNum=CkEditorImageBrowser.getQueryStringParam("CKEditorFuncNum"),CkEditorImageBrowser.initEventHandlers(),CkEditorImageBrowser.loadData(CkEditorImageBrowser.getQueryStringParam("listUrl"),function(){CkEditorImageBrowser.initFolderSwitcher()})},loadData:function(e,r){CkEditorImageBrowser.folders=[],CkEditorImageBrowser.images={},$.getJSON(e,function(e){$.each(e,function(e,r){"undefined"==typeof r.folder&&(r.folder="Images"),"undefined"==typeof r.thumb&&(r.thumb=r.image),CkEditorImageBrowser.addImage(r.folder,r.image,r.thumb)}),r()}).error(function(r,t,o){CkEditorImageBrowser.$imagesContainer.html(200>r.status||400<=r.status?"HTTP Status: "+r.status+"/"+r.statusText+': "<strong style="color: red;">'+e+'</strong>"':"parsererror"===t?t+': invalid JSON file: "<strong style="color: red;">'+e+'</strong>": '+o.message:t+" / "+r.statusText+" / "+o.message)})},addImage:function(e,r,t){"undefined"==typeof CkEditorImageBrowser.images[e]&&(CkEditorImageBrowser.folders.push(e),CkEditorImageBrowser.images[e]=[]),CkEditorImageBrowser.images[e].push({imageUrl:r,thumbUrl:t})},initFolderSwitcher:function(){var e=CkEditorImageBrowser.$folderSwitcher;e.find("li").remove(),$.each(CkEditorImageBrowser.folders,function(r,t){$("<li></li>").data("idx",r).text(t).appendTo(e)}),0===CkEditorImageBrowser.folders.length?(e.remove(),CkEditorImageBrowser.$imagesContainer.text("No images.")):(1===CkEditorImageBrowser.folders.length&&e.hide(),e.find("li:first").click())},renderImagesForFolder:function(e){var e=CkEditorImageBrowser.images[e],r=$("#js-template-image").html();CkEditorImageBrowser.$imagesContainer.html(""),$.each(e,function(e,t){var o=r,o=o.replace("%imageUrl%",t.imageUrl),o=o.replace("%thumbUrl%",t.thumbUrl),o=$($.parseHTML(o));CkEditorImageBrowser.$imagesContainer.append(o)})},initEventHandlers:function(){$(document).on("click","#js-folder-switcher li",function(){var e=parseInt($(this).data("idx"),10),e=CkEditorImageBrowser.folders[e];$(this).siblings("li").removeClass("active"),$(this).addClass("active"),CkEditorImageBrowser.renderImagesForFolder(e)}),$(document).on("click",".js-image-link",function(){window.opener.CKEDITOR.tools.callFunction(CkEditorImageBrowser.ckFunctionNum,$(this).data("url")),window.close()})},getQueryStringParam:function(e){return(e=window.location.search.match(RegExp("[?&]"+e+"=([^&]*)")))&&1<e.length?decodeURIComponent(e[1]):null}};